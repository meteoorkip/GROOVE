% -----------------------------------------------------------------------------
% discussion.tex
% -----------------------------------------------------------------------------

\section{Guidelines}
\stlabel{discussion}

We are now ready to generalise the content from the previous section into some
tool usage guidelines. As discussed in the introduction, it should be born in
mind that these apply in the problem class of state space search (which occurs
for instance in model checking), where the dreaded space state explosion has to
be tamed. For users employing \GROOVE in other settings, \cite{GMR+12} offers
some more recommendations.

Furthermore, the guidelines below focus mainly on \GROOVE characteristics and
features; we do not explicitly present generalisations applicable to other
tools as this would require an extensive comparison of
functionalities. However, users of other similar tools can lean on the
similarities to transfer these guidelines to their own tool, when
applicable. Comparisons between \GROOVE and other existing graph
transformation tools are given in~\cite{GMR+12,Jakumeit+2013}.

\vspace{-\medskipamount}
\paragraph{Minimalism is beautiful.} State space exploration entails generating
and \emph{storing} all reachable graphs of the grammar, meaning that every
rule application yields a new state that has to be kept in memory. While
several optimisations are programmed in the tool (\eg, keeping only the deltas
between source and target states), the bottom line here is \emph{keep your
graphs to a bare minimum}, as smaller and simpler graphs usually help
performance. Of course, as discussed in \stref{grammar}, this recommendation
needs not to be taken to extremes. In the end, the user is presented with an
engineering problem, where a proper balance between graph simplicity,
performance, and ease of grammar design has to be found.
%
An exception should be made here concerning \emph{remark} nodes and edges,
which can be used to document rules: these are quite helpful and cause no
overhead in the exploration.

\begin{table}[t]
\centering
\small
\input{results/non-iso-results}
\caption{Results obtained by varying $N$ with isomorphism checking disabled.}
\tablabel{iso-off}
\vspace{-.5cm}
\end{table}

\vspace{-\medskipamount}
\paragraph{Symmetry is your friend.} The main feature that distinguishes
\GROOVE from other model checkers is its representation of states as graphs.
This representation in turn allows the tool to perform symmetry reduction of
similar states, by collapsing isomorphic graphs into a single canonical
representative.

Much research has been done to make isomorphism checks fast. \GROOVE uses
\emph{certificates} (a sort of graph hash) to speed up comparisons, which
works very well in practice~\cite{Ren06}. To illustrate the impact symmetry
reduction has on our running example, we ran exploration tests for $N$ up to 9
with isomorphism checking disabled, with \tabref{iso-off} showing the results.
Taking for instance the 8-queens problem, the state space doubles in size when
isomorphism checks are not used, with the running time for the exploration also
doubling accordingly.

Of course, for isomorphism checks to be effective, state graphs need to contain
a certain degree of symmetry. When this symmetry is not present in the real
world artefact being modelled, the checks can be disabled to avoid unnecessary
overhead. However, in general the user should \emph{strive for host graph
representations that have symmetry}, as was done for this case study. A
suggestion for achieving this is sticking to standard graphs (with nodes and
edges only) when possible. An example was discussed in \stref{grammar}:
attributes make nodes distinct and therefore break symmetry.

\vspace{-\medskipamount}
\paragraph{Be greedy when designing your rules.} Here the recommendation is
simple: \emph{do as much as possible in one rule} to avoid producing unnecessary
intermediates states. This was illustrated in \fref{n-queens-rules}(b) with rule
\glabel{rename}; we want to relabel all edges of the board, so we do it in one
step using universal quantification. Had this relabelling been done in a
stepwise fashion, it would generate possibly many additional states storing the
mixed board representation; a wasted effort since all these states end up in
the same final configuration.

\GROOVE allows nested quantification of rule conditions, enabling one to write
very expressive transformation rules~\cite{RK09}. In~\cite{Ren06b}, an analysis
of a gossiping network protocol showed that the grammar state space is reduced
by 2 orders of magnitude when quantification is used.

\vspace{-\medskipamount}
\paragraph{Keep your rules under control.} The interleaving of rule
applications is one of the big culprits of state space explosion, as every
sequence of applicable rules have to be considered. Furthermore, rule matching
is an NP-complete problem, and therefore, computationally expensive. Luckily,
rule applications usually follow some predetermined sequence that can be used.
The simplest form of rule ordering in \GROOVE is done with priorities: a lower
priority rule is only scheduled for matching if all other rules with higher
priority are not applicable. A more powerful and flexible form of scheduling
uses control programs, such as the one shown in \lstref{control}. Except for the
most simpler cases, the use of control programs is usually preferred over
priorities, since programs allow more complex rule sequencing. In the end, the
take away message is: \emph{use some form of rule scheduling whenever possible}.

\vspace{-\medskipamount}
\paragraph{Make sure to get your results out.} The simplest form of state space
analysis is by visual inspection but this can only be done for very small
transition systems (LTSs). For larger LTSs, the usual method is model checking,
and \GROOVE supports both variants: CTL and LTL formul\ae. However, model
checking can be cumbersome as it requires the entire property of interest to be
written in a single logical formula. A much more flexible method is the use of
Prolog queries, such as the one given in \lstref{prolog}. All in all, here the
message is: \emph{there are several methods for state space analysis, make
sure to pick the one most suitable to your needs}.
